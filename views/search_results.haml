- if params[:advanced] == 'true'
  %div#advanced-description.span-24
    %div.span-6
      %h2.right{ :style => 'margin: 0;' } Advanced Search
      %p.right{ :style => 'margin: 0 .5em' }
        %a{ :href => advanced_page_url } Modify Your Search
    %div.span-18.last
      %p{ :style => 'margin: .5em 0 0 0;' }
        - active_advanced_search_fields(params).each_with_index do |param, position| 
          - unless param[1].strip == '' or param[0] == 'advanced' or param[0] == 'operator'
            %span.active-search-item
              %span.key= "#{advanced_search_field_display_names[param[0]]}:"
              %span.value= param[1]
              %a.remove-item{ :href => remove_advanced_search_term(param[0]) } Remove constraint
            -  if (position + 1) < active_advanced_search_fields(params).size
              %span.operator= params['operator'] 

- if @results
  %div#search-results.span-24.last
  
    %div#facets.span-6
      %h2 Facets
      
      %h3 Format
      - item_type_facet = @results.facets.select {|f| f.index == 'itemType'}.first
      = partial :facet, :locals => { :facet => item_type_facet }
      
      %h3 Author/Creator
      - creator_facet = @results.facets.select {|f| f.index == 'creator'}.first
      = partial :facet, :locals => { :facet => creator_facet }
      
      %h3 Language
      - language_facet = @results.facets.select {|f| f.index == 'inLanguage'}.first
      = partial :facet, :locals => { :facet => language_facet }
      
    %div#search-results.span-18.last
      %h2 Results
      
      %div.search-page-navigation.span-18.last
        - _pagination = pagination(params, @results)
        %div.previous.span-6.first
          - if _pagination[:previous_page_start] 
            %a{:href => previous_page_url(_pagination)} &laquo; Previous
          - else
            %span.inactive-link &laquo; Previous

        %div.numbering.span-6
          = "#{separate_comma(_pagination[:first])} - #{separate_comma(_pagination[:last])} of #{separate_comma(_pagination[:total])}"

        %div.next.span-6.last
          - if _pagination[:next_page_start] 
            %a{:href => next_page_url(_pagination)} Next &raquo;
          - else
            %span.inactive-link Next &raquo;

      %ol#results-items.span-18{ :start => @results.start_index + 1 }
        - @results.bibs.each do |bib| 
          %li.search-result
            %h3.title
              %a{ :href => url("/catalog/#{bib.oclc_number}")}= bib.name
              %span.date-published= bib.date_published
            - if bib.author
              %p.author= bib.author.name
            - elsif bib.contributors and bib.contributors.size > 0
              %p.author= bib.contributors.map {|contributor| contributor.name}.join('; ')
            %p.format
              %span.label Format:
              %span.value= FORMATS[bib.type.to_s]
